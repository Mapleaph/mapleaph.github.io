
<!DOCTYPE html>
<html lang="zh-CN">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="DreamLand">
    <title>Kategorie: Techniques - DreamLand</title>
    <meta name="author" content="Michael Wu">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="DreamLand">
<meta property="og:url" content="http://yoursite.com/categories/Techniques/index.html">
<meta property="og:site_name" content="DreamLand">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DreamLand">
<meta name="twitter:creator" content="@mapleaph">
    
    
        
    
    
        <meta property="og:image" content="http://yoursite.com/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">DreamLand</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="Bild des Autors"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="Bild des Autors"/>
                </a>
                <h4 class="sidebar-profile-name">Michael Wu</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Kategorien"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Kategorien</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archiv"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archiv</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                            title="Suche"
                        >
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Suche</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="#about"
                            
                            title="Über"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Über</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/mapleaph" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://twitter.com/mapleaph" target="_blank" rel="noopener" title="Twitter">
                    
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/mapleaph@gmail.com"
                            title="E-Mail"
                        >
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">E-Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/12/26/Customize-Redmine-Plugin-Dmsf/">
                            Customize Redmine Plugin Dmsf
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-12-26T17:35:49+08:00">
	
		    26 12月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Add-a-Hook-in-the-Redmine-Source"><a href="#Add-a-Hook-in-the-Redmine-Source" class="headerlink" title="Add a Hook in the Redmine Source"></a>Add a Hook in the Redmine Source</h2><p>This official redmine source doesn’t provide a hook if I what to do something just after a project created. So I’m gonna write a hook on my own.</p>
<p>In the file /path/to/redmine/app/controllers/projects_controller.rb, we just add a one-line code like this:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span></span></span><br><span class="line">    @issue_custom_fields = IssueCustomField.sorted.to_a</span><br><span class="line">    @trackers = Tracker.sorted.to_a</span><br><span class="line">    @project = Project.new</span><br><span class="line">    @project.safe_attributes = params[<span class="symbol">:project</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> @project.save</span><br><span class="line">      <span class="keyword">unless</span> User.current.admin?</span><br><span class="line">        @project.add_default_member(User.current)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      call_hook(<span class="symbol">:controller_project_new_after_save</span>, &#123;<span class="symbol">:params</span> =&gt; params, <span class="symbol">:project</span> =&gt; @project&#125;)</span><br></pre></td></tr></table></figure>
<p>The call_hook line is what the functionality takes place. Notice that we should add the line inside the create function not new function.</p>
<p>Next, we can actually do something nice by adding a file /path/to/redmine/plugins/redmine_dmsf/lib/redmine_dmsf/hooks/controller_project_new_after_save.rb</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">module</span> <span class="title">RedmineDmsf</span></span></span><br><span class="line">    <span class="class"><span class="keyword">module</span> <span class="title">Hooks</span></span></span><br><span class="line">        <span class="keyword">include</span> Redmine::Hook</span><br><span class="line"></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">ControllerProjectNewAfterSaveHook</span> &lt; Redmine::Hook::<span class="title">ViewListener</span></span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">controller_project_new_after_save</span><span class="params">(context=&#123; &#125;)</span></span></span><br><span class="line"></span><br><span class="line">                params = context[<span class="symbol">:params</span>]</span><br><span class="line">                project = context[<span class="symbol">:project</span>]</span><br><span class="line"></span><br><span class="line">                <span class="comment"># then you can add code whatever you like.</span></span><br></pre></td></tr></table></figure>
<p>Finally, we should add the file path to the redmine_dmsf.rb file under /path/to/redmine/plugins/redmine_dmsf/lib.</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require</span> <span class="string">'redmine_dmsf/hooks/controller_project_new_after_save_hook'</span></span><br></pre></td></tr></table></figure>
<h2 id="Update-Database"><a href="#Update-Database" class="headerlink" title="Update Database"></a>Update Database</h2><p>If we want to update the database by just one command, you can add a ruby file called seeds.rb under the folder /path/to/redmine/db/, then execute the command in the redmine command line environment.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rake db:seed RAILS_ENV=production</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/12/26/Customize-Redmine-Plugin-Dmsf/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/26/Things-Need-to-Know-about-Mac-OSX/">
                            Things Need to Know about Mac OS X
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-26T21:10:55+08:00">
	
		    26 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h2><ol>
<li><p>剪切</p>
<p> <strong>Command + drag</strong></p>
</li>
<li><p>复制</p>
<p> <strong>Option + drag</strong></p>
</li>
<li><p>创建符号链接</p>
<p> <strong>Command + Option + drag</strong></p>
</li>
</ol>
<h2 id="安装-gdb"><a href="#安装-gdb" class="headerlink" title="安装 gdb"></a>安装 gdb</h2><p>Mac OS X 从 10.9 开始选择 lldb 而不是 gdb 作为程序调试器，选用 clang 和 llvm 分别代替 gcc 和 ld。</p>
<p>如果想要安装 gdb，可以通过如下命令实现：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install homebrew/dupes/gdb</span><br></pre></td></tr></table></figure>
<h2 id="system-profiler-同-lsusb-命令"><a href="#system-profiler-同-lsusb-命令" class="headerlink" title="system_profiler (同 lsusb 命令)"></a>system_profiler (同 lsusb 命令)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system_profiler SPUSBDataType</span><br></pre></td></tr></table></figure>
<h2 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h2><p>打开终端使用 SSH 成功连接服务器后，出现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">warning: setlocale: LC_CTYPE: cannot change locale (UTF-8): No such file or directory</span><br></pre></td></tr></table></figure>
<p>的问题，解决方法如下：</p>
<p>将 /etc/ssh_config 文件的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SendEnv LANG LC_*</span><br></pre></td></tr></table></figure>
<p>一行注释掉，然后保存并重启终端即可。</p>
<h2 id="如何在-Mac-下关闭指定端口对应进程"><a href="#如何在-Mac-下关闭指定端口对应进程" class="headerlink" title="如何在 Mac 下关闭指定端口对应进程"></a>如何在 Mac 下关闭指定端口对应进程</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:&lt;port&gt;</span><br><span class="line"><span class="comment">#上面的命令会列出占用端口的进程，可能不止一个，然后根据进程号 kill 掉对应进程</span></span><br><span class="line"><span class="built_in">kill</span> &lt;pid&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Doxygen"><a href="#Doxygen" class="headerlink" title="Doxygen"></a>Doxygen</h2><ol>
<li><p>brew install graphviz</p>
</li>
<li><p>change the configuration LATEX_CMD_NAME to pdflatex</p>
</li>
<li><p>change the configuration DOT_PATH to /path/to/dot</p>
</li>
<li><p>in the Diagrams Topics of the Wizard tab, change the Diagrams to generate to Use dot tool from the GraphViz package and check all the boxes</p>
</li>
<li><p>in the Mode Topics of the Wizard tab, change the Select the desired extraction mode to All Entities and check the Include cross-referenced source code in the output</p>
</li>
</ol>
<h2 id="命令行下用-Sublime-Text-打开文件"><a href="#命令行下用-Sublime-Text-打开文件" class="headerlink" title="命令行下用 Sublime Text 打开文件"></a>命令行下用 Sublime Text 打开文件</h2><p>该方法同样适用于其他类似软件，如 MacDown。</p>
<ul>
<li><p>方法一</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 其中 Sublime\ Text 是应用程序的名称</span></span><br><span class="line">$ open -a Sublime\ Text &lt;file&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先建立软链接</span></span><br><span class="line">$ sudo ln -s /Applications/Sublime\ Text.app/Contents/SharedSupport/bin/subl /usr/<span class="built_in">local</span>/bin/subl</span><br><span class="line"><span class="comment"># 此后直接用命令打开，更加方便</span></span><br><span class="line">$ subl &lt;file&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/26/Things-Need-to-Know-about-Mac-OSX/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/26/Solaris/">
                            Solaris
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-26T21:08:48+08:00">
	
		    26 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Reinstall-grub"><a href="#Reinstall-grub" class="headerlink" title="Reinstall grub"></a>Reinstall grub</h2><p>When you get a grub prompt:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /multiboot</span><br></pre></td></tr></table></figure>
<p>suppose you get a result of (hd0,0), then</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root (hd0,0)</span><br><span class="line">kernel /platform/i86pc/multiboot</span><br><span class="line">module /platform/i86pc/boot_archive</span><br><span class="line">boot</span><br></pre></td></tr></table></figure>
<p>If you don’t know what the above command is, type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /boot/grub/menu.lst</span><br></pre></td></tr></table></figure>
<p>When you enter the OS, open a terminal and type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">format -e <span class="comment"># you will get a device id related to the boot disk</span></span><br><span class="line">installgrub -m /boot/grub/stage1 /boot/grub/stage2 /dev/rdks/&lt;device-id&gt;</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<h2 id="Non-cdrom-installation-for-Solaris-u8-Non-cdrom-installation-for-Solaris-u8"><a href="#Non-cdrom-installation-for-Solaris-u8-Non-cdrom-installation-for-Solaris-u8" class="headerlink" title="Non-cdrom installation for Solaris-u8 Non-cdrom installation for Solaris-u8"></a>Non-cdrom installation for Solaris-u8 Non-cdrom installation for Solaris-u8</h2><ol>
<li><p>Extract “multiboot” and “x86.miniroot” file from “sol-10-u8-ga-x86-dvd.iso”, put those two files into a usb flash disk;</p>
</li>
<li><p>Use “grub” to boot the system, then press “c” to enter the grub shell menu;</p>
</li>
<li><p>Type the following commands:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">find /multiboot</span><br><span class="line"><span class="comment"># Use the result "(hdx,y)" of the first command, then</span></span><br><span class="line">kernel (hdx,y)/multiboot kernel/unix -B install_media=dsk</span><br><span class="line">module (hdx,y)/x86.miniroot</span><br><span class="line">boot</span><br></pre></td></tr></table></figure>
</li>
<li><p>If the above step succeded, then you will see Solaris is starting to boot, after you select 1, you will be given a “sh” shell prompt;</p>
</li>
<li><p>In the shell, you should type the following commands:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># the actual string after dsk, maybe different on your own system</span></span><br><span class="line">mount -F pcfs /dev/dsk/c0d0p0:1 /mnt</span><br><span class="line">lofiadm -a /mnt/sol-10-u8-ga-x86-dvd.iso</span><br><span class="line">mount -F hsfs /dev/lofi/1 /cdrom</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>After all these steps, the Solaris installation process is starting.</p>
</li>
</ol>
<h2 id="Cannot-enter-into-GUI-when-booting-Solaris"><a href="#Cannot-enter-into-GUI-when-booting-Solaris" class="headerlink" title="Cannot enter into GUI when booting Solaris"></a>Cannot enter into GUI when booting Solaris</h2><p>Enter into FailSafe mode, then type:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bootadm update-archive -R /a</span><br></pre></td></tr></table></figure>
<h2 id="Solaris-10-u8-在家目录下新建目录的方法"><a href="#Solaris-10-u8-在家目录下新建目录的方法" class="headerlink" title="Solaris 10-u8 在家目录下新建目录的方法"></a>Solaris 10-u8 在家目录下新建目录的方法</h2><p>默认情况下，root 用户不能在 /home 下新建目录，因为 /home 目录是由 automounter 管理的，我们可以手动修改，让可以在 root 在 /home 下新建目录。</p>
<ol>
<li><p>将 /etc/auto_master 中的 /home 一行注释掉</p>
</li>
<li><p>运行 automounter -v 使修改生效。</p>
</li>
</ol>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/26/Solaris/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/22/NeoKylin/">
                            NeoKylin
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-22T12:02:57+08:00">
	
		    22 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="x86-版安装"><a href="#x86-版安装" class="headerlink" title="x86 版安装"></a>x86 版安装</h2><h3 id="NeoKylin-Personal-v6-0-安装方法更新-UPDATE"><a href="#NeoKylin-Personal-v6-0-安装方法更新-UPDATE" class="headerlink" title="NeoKylin-Personal-v6.0 安装方法更新 [UPDATE]"></a>NeoKylin-Personal-v6.0 安装方法更新 [UPDATE]</h3><p>使用 UltraISO 将镜像中的 images/boot.iso 提取出来，然后将其刻录到 U 盘中<br>启动系统，按 TAB 键，将启动参数改为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmlinuz initrd=initrd.img repo=hd:/dev/sda4:/ quiet</span><br></pre></td></tr></table></figure>
<p>之后正常安装即可。</p>
<p>中标麒麟除了 V5，V6 并没有更精确的版本号描述，目前手中共有两个 V6 的版本，只能以默认安装的内核版本进行区分。</p>
<p><strong>!!如果你能把中标麒麟的 iso 镜像文件刻录到光盘里的话，本文档就可以不用看了!!</strong></p>
<h3 id="2-6-36-版"><a href="#2-6-36-版" class="headerlink" title="2.6.36 版"></a>2.6.36 版</h3><p>本文档仅针对使用 U 盘安装系统的情况，目前共验证了两种方式，一种为本地安装，另一种为 FTP 安装。</p>
<h4 id="本地安装"><a href="#本地安装" class="headerlink" title="本地安装"></a>本地安装</h4><p>硬盘一个，U 盘一个，一个 Puppy Linux 系统。</p>
<p>Puppy Linux 下载地址：<a href="http://distro.ibiblio.org/puppylinux/" target="_blank" rel="noopener">http://distro.ibiblio.org/puppylinux/</a></p>
<p>本测试选用 Puppy 5.6 目录下的 slacko-5.6-PAE.iso</p>
<ol>
<li><p>使用 puppy linux 为 U 盘安装 Grub4Dos，将 isolinux 文件夹从麒麟系统镜像中提取出来，并复制到 U 盘中，然后更改 U 盘中的 grub.conf 文件为如下内容：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root (hdx,y)</span><br><span class="line">kernel /isolinux/vmlinuz</span><br><span class="line">initrd /isolinux/initrd.img</span><br><span class="line">boot</span><br></pre></td></tr></table></figure>
<p> 其中 (hdx,y) 需要根据实际情况进行修改。</p>
</li>
<li><p>对目标硬盘进行分区，注意需要多分出一个分区来，大小 5GB 即可，格式 FAT32/EXT4，用来存放麒麟的系统镜像和从镜像中提取出来的 images 文件夹。</p>
</li>
<li><p>使用 U 盘引导系统，在选择镜像所在磁盘时，选择上一步那个多分出来的分区，这一步找的是 images/install.img 文件。</p>
</li>
<li><p>在之后的安装方式上选择自定义磁盘分区，注意不要挂在最后一个分区，否则之后会出错。</p>
</li>
<li><p>如果在接下来查找镜像时出现 device or resource busy 的错误，那么这种安装方式宣告失败，请换用下面的 FTP 安装方式。</p>
</li>
</ol>
<h4 id="FTP-安装"><a href="#FTP-安装" class="headerlink" title="FTP 安装"></a>FTP 安装</h4><p>如果用的是 Mac 系统，可以选用，Rumpus FTP Server 进行 FTP 服务器搭建，如果用 Windows，可用 File zilla。</p>
<ol>
<li><p>同本地安装的第一步</p>
</li>
<li><p>将 Packages, repodata, images 文件夹从系统镜像中提取出来并放到 ftp 服务器根目录中。</p>
</li>
<li><p>用 U 盘启动系统，镜像存在位置选择 URL，然后在地址栏中输入 ftp://192.168.x.x/ 正常情况下，会显示 retrieving…，只有按部就班安装即可。</p>
</li>
</ol>
<h3 id="3-3-4-版"><a href="#3-3-4-版" class="headerlink" title="3.3.4 版"></a>3.3.4 版</h3><ol>
<li><p>将 images/boot.iso 从镜像中提取出来</p>
</li>
<li><p>用 UltraISO 将 boot.iso 写入 U 盘</p>
</li>
<li><p>将麒麟系统镜像拷贝到 U 盘中</p>
</li>
<li><p>用 U 盘引导系统，在出现安装菜单时按 TAB 键，将命令改为</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo=hd:/dev/sdb4:/ quiet</span><br></pre></td></tr></table></figure>
<p> 如果在安装前检测硬盘时提示：<br> “Disk sda contains BIOS RAID metadata, but is not part of any recognized BIOS RAID sets. Ignoring disk sda”<br> 那么就需要改为：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">repo=hd:/dev/sdb4:/ quiet nodmraid</span><br></pre></td></tr></table></figure>
</li>
<li><p>之后按部就班安装即可。</p>
</li>
</ol>
<h2 id="中标麒麟-RapidIO-安装指南"><a href="#中标麒麟-RapidIO-安装指南" class="headerlink" title="中标麒麟 RapidIO 安装指南"></a>中标麒麟 RapidIO 安装指南</h2><h3 id="磁盘规划"><a href="#磁盘规划" class="headerlink" title="磁盘规划"></a>磁盘规划</h3><p>总共 20GB</p>
<table>
<thead>
<tr>
<th>partition</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr>
<td>bios-boot</td>
<td>1MB</td>
</tr>
<tr>
<td>boot</td>
<td>500MB</td>
</tr>
<tr>
<td>root</td>
<td>16GB</td>
</tr>
<tr>
<td>swap</td>
<td>3GB</td>
</tr>
</tbody>
</table>
<p>编译完内核的剩余空间为：3.8GB</p>
<h3 id="修改安装源"><a href="#修改安装源" class="headerlink" title="修改安装源"></a>修改安装源</h3><p>提示：该步骤需要确保系统能够联网！</p>
<p>首先删除 [/etc/yum.repo.d/] 下面的两个文件，然后新建名为 f17.repo 的文件并向其中添加如下内容：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[fedora]</span><br><span class="line">name=f17</span><br><span class="line">baseurl=http://archives.fedoraproject.org/pub/archive/fedora/linux/releases/17/Fedora/i386/os/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[everything]</span><br><span class="line">name=f17-everything</span><br><span class="line">baseurl=http://archives.fedoraproject.org/pub/archive/fedora/linux/releases/17/Everything/i386/os/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line"></span><br><span class="line">[updates]</span><br><span class="line">name=f17-updates</span><br><span class="line">baseurl=http://archives.fedoraproject.org/pub/archive/fedora/linux/updates/17/i386/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br></pre></td></tr></table></figure>
<p>保存，退出。</p>
<h3 id="更新安装源"><a href="#更新安装源" class="headerlink" title="更新安装源"></a>更新安装源</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum list</span><br></pre></td></tr></table></figure>
<h3 id="安装-ncurses-库（make-menuconfig-的时候会用到）"><a href="#安装-ncurses-库（make-menuconfig-的时候会用到）" class="headerlink" title="安装 ncurses 库（make menuconfig 的时候会用到）"></a>安装 ncurses 库（make menuconfig 的时候会用到）</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo yum install ncurses-devel</span><br></pre></td></tr></table></figure>
<h3 id="下载内核源代码"><a href="#下载内核源代码" class="headerlink" title="下载内核源代码"></a>下载内核源代码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~; curl -O https://www.kernel.org/pub/linux/kernel/v3.x/linux-3.3.4.tar.bz2</span><br><span class="line"><span class="comment"># 等待下载完成后，解压刚刚下载的压缩包并移动到 /usr/src/kernels 目录下</span></span><br><span class="line">$ tar jxf linux-3.3.4.tar.bz2; sudo mv linux-3.3.4 /usr/src/kernels</span><br></pre></td></tr></table></figure>
<h3 id="对内核进行配置"><a href="#对内核进行配置" class="headerlink" title="对内核进行配置"></a>对内核进行配置</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/linux-3.3.4/; make mrproper; cp /boot/config-3.3.4-5.1.nk.i686.PAE .config</span><br><span class="line">$ make menuconfig</span><br><span class="line"><span class="comment"># 下面进入内核配置界面</span></span><br><span class="line"><span class="comment"># 将对两个地方进行配置</span></span><br><span class="line"><span class="comment"># 1. 添加 RapidIO 支持</span></span><br><span class="line"><span class="comment">#    进入 Bus options (PCI etc.)，选中 RapidIO support，将会弹出子菜单，根据硬件型号，选择前 4 项，即：</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#    IDT Tsi721 PCI Express SRIO Controller support</span></span><br><span class="line"><span class="comment">#    Discovery timeout duration (seconds) 该值默认为 30</span></span><br><span class="line"><span class="comment">#    Enable RapidIO Input/Output Ports</span></span><br><span class="line"><span class="comment">#    RapidIO subsystem debug messages</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 2. 去掉默认的启动图片，防止跟中标麒麟的默认开机画面相冲突，不改的话会出现一个小企鹅图片，但不影响 RapidIO 功能的实现：</span></span><br><span class="line"><span class="comment">#    进入 Device Drivers -&gt; Graphics support，取消选中 Bootup logo 即可。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 确认修改后，退出保存即可。</span></span><br></pre></td></tr></table></figure>
<h3 id="编译、安装新内核"><a href="#编译、安装新内核" class="headerlink" title="编译、安装新内核"></a>编译、安装新内核</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CPU 有几个核，下面的 -j 后面的 n 就改成几，这样可以加快编译速度</span></span><br><span class="line">$ make -j&lt;n&gt;; make modules; sudo make modules_install; sudo make install</span><br><span class="line"><span class="comment"># 过程中会提示输入密码，请注意，安装完成后，重启系统，将会在启动菜单看到一个 RedHat Linux (3.3.4), 这就是我们的新内核，选这个进入系统就行了。</span></span><br></pre></td></tr></table></figure>
<h3 id="小修改"><a href="#小修改" class="headerlink" title="小修改"></a>小修改</h3><ol>
<li><p>删除旧内核的相关文件</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rm /boot/System.map* /boot/vmlinuz* /boot/config-3.3.4-5.1.nk.i686.PAE</span><br><span class="line">$ sudo rm -rf /lib/modules/3.3.4-5.1.nk.i686.PAE</span><br><span class="line">$ sudo rm -rf /usr/src/kernels/3.3.4-5.1.nk.i686.PAE</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成新的 grub.cfg</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo grub2-mkconfig -o /boot/grub2/grub.cfg</span><br><span class="line"><span class="comment"># 生成后再对文件进行进一步修改，将 menuentry 后面的 text 去掉</span></span><br></pre></td></tr></table></figure>
<p> 保存，退出。</p>
</li>
</ol>
<h3 id="旧版本麒麟编译安装-2-6-35-版本内核"><a href="#旧版本麒麟编译安装-2-6-35-版本内核" class="headerlink" title="旧版本麒麟编译安装 2.6.35 版本内核"></a>旧版本麒麟编译安装 2.6.35 版本内核</h3><p>需要卸载 VirtualBox，否则 make install 的时候会报错。</p>
<p>使用如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rpm -qa | grep VirtualBox | xargs sudo rpm -e</span><br></pre></td></tr></table></figure>
<h3 id="安装串口测试程序-xgcom-的方法"><a href="#安装串口测试程序-xgcom-的方法" class="headerlink" title="安装串口测试程序 xgcom 的方法"></a>安装串口测试程序 xgcom 的方法</h3><p>这里讨论的是内核版本为 2.6.36 的中标麒麟</p>
<ol>
<li><p>在 <a href="https://code.google.com/p/xgcom/" target="_blank" rel="noopener">https://code.google.com/p/xgcom/</a> 下载 xgcom-0.04.2 版本源码包</p>
</li>
<li><p>删除系统自带的 vte，这个会同时删除 gnome-terminal 和 gnome-color-manager</p>
</li>
<li><p>将下面的信息新建为文件 f13.repo，并放到 /etc/yum.repo.d/ 目录下</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[f13]</span><br><span class="line">name=f13</span><br><span class="line">baseurl=http://archives.fedoraproject.org/pub/archive/fedora/linux/releases/13/Fedora/i386/os</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line"></span><br><span class="line">[f13-everything]</span><br><span class="line">name=f13-everything</span><br><span class="line">baseurl=http://archives.fedoraproject.org/pub/archive/fedora/linux/releases/13/Everything/i386/os</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>
</li>
<li><p>将其他源禁用掉</p>
</li>
<li><p>安装 vte, vte-devel, gnome-terminal, gnome-color-manager</p>
</li>
<li><p>进入 xgcom 的源码</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./autogen.sh</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="龙芯版安装"><a href="#龙芯版安装" class="headerlink" title="龙芯版安装"></a>龙芯版安装</h2><h3 id="系统安装"><a href="#系统安装" class="headerlink" title="系统安装"></a>系统安装</h3><p><strong>目前仅支持整盘复制安装</strong></p>
<ol>
<li>需要一个可启动的 Linux 系统；</li>
<li>在 Linux 系统下，重新对目标硬盘进行分区，要求为：整盘一个分区，可以启动，格式为 ext3；</li>
<li><p>挂载目标硬盘，进行文件复制：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 假设 sda1 为目标硬盘的分区</span></span><br><span class="line">$ mount /dev/sda1 /mnt/</span><br><span class="line">$ tar --numeric-owner -xlpvf Neokylin-DT6-img.tar.gz -C /mnt --touch</span><br><span class="line"><span class="comment"># 复制完成之后，卸载目标硬盘</span></span><br><span class="line">$ umount /dev/sda1</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 开机进入 PMON 引导命令行，使用 devls 命令查看设备名称，</span></span><br><span class="line"><span class="comment"># 假设得到的硬盘名称为 wd0</span></span><br><span class="line">load /dev/fs/ext2@wd0/boot/vmlinux.3a_newspec</span><br><span class="line"><span class="comment"># 等待加载成功</span></span><br><span class="line">g console=tty root=/dev/sda1 quiet splash loglevel=0</span><br><span class="line"><span class="comment"># 正常情况下，即等待进入桌面</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="升级-Qt4-8-5"><a href="#升级-Qt4-8-5" class="headerlink" title="升级 Qt4.8.5"></a>升级 Qt4.8.5</h3><p>适用系统版本：NeoKylin-Desktop-V6.0-Update4-Loongson-Release-Build050-20140124 (可用 cat /etc/.product_info 查看)。</p>
<p>执行如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo rpm -Uvh qt-4.8.6-10.ND6.2.mipsel.rpm \</span><br><span class="line">qt-x11-4.8.6-10.ND6.2.mipsel.rpm \</span><br><span class="line">qt-devel-4.8.6-10.ND6.2.mipsel.rpm \</span><br><span class="line">qt-demos-4.8.6-10.ND6.2.mipsel.rpm \</span><br><span class="line">qt-examples-4.8.6-10.ND6.2.mipsel.rpm \</span><br><span class="line">qt-odbc-4.8.6-10.ND6.2.mipsel.rpm \</span><br><span class="line">qt-doc-4.8.6-10.ND6.2.noarch.rpm \</span><br><span class="line">qt-assistant-4.8.6-10.ND6.2.mipsel.rpm \</span><br><span class="line">qtwebkit-2.2-3.20110513.ND6.3.mipsel.rpm \</span><br><span class="line">libjpeg-turbo-devel-1.2.90-2.ND6.mipsel.rpm \</span><br><span class="line">libjpeg-turbo-1.2.90-2.ND6.mipsel.rpm \</span><br><span class="line">libjpeg-turbo-static-1.2.90-2.ND6.mipsel.rpm</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/22/NeoKylin/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/22/Windows-Device-Driver/">
                            Windows Device Driver
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-22T11:26:52+08:00">
	
		    22 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p><strong>This guide is for the target of pci bus device and its sub-devices resources allocation.</strong></p>
<h2 id="For-Bus-Driver"><a href="#For-Bus-Driver" class="headerlink" title="For Bus Driver"></a>For Bus Driver</h2><p>First you should design a customized data structure for storing the resource you gethered, let’s just called it DEVICE_EXTENSION:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> structure &#123;</span><br><span class="line"></span><br><span class="line">  WDFDEVICE device;</span><br><span class="line"></span><br><span class="line">  ULONG port0Base;</span><br><span class="line">  ULONG port0Length;</span><br><span class="line"></span><br><span class="line">  ULONG port1Base;</span><br><span class="line">  ULONG port1Length;</span><br><span class="line"></span><br><span class="line">  ....</span><br><span class="line"></span><br><span class="line">&#125; DEVICE_EXTENSION, *PDEVICE_EXTENSION;</span><br></pre></td></tr></table></figure>
<p>suppose your bus device has two io ports.</p>
<p>then you should register a callback function <strong>before</strong> calling WdfDeviceCreate:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">EVT_WDF_DEVICE_RESOURCES_PREPARE_HARDWARE Bus_EvtDevicePrepareHardware;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ALLOC_PRAGMA</span></span><br><span class="line"><span class="function">pragma <span class="title">alloc_text</span> <span class="params">(PAGE, Bus_EvtDevicePrepareHardware)</span></span>;</span><br><span class="line">...</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">xxxEvtDeviceAdd</span><span class="params">(IN WDFDRIVER Driver, IN PWDFDEVICE_INIT DeviceInit)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    WDF_PNPPOWER_EVENT_CALLBACKS pnpPowerCallbacks;</span><br><span class="line"></span><br><span class="line">    WDF_PNPPOWER_EVENT_CALLBACKS_INIT(&amp;pnpPowerCallbacks);</span><br><span class="line"></span><br><span class="line">    pnpPowerCallbacks.EvtDevicePrepareHardware = Bus_EvtDevicePrepareHardware;</span><br><span class="line"></span><br><span class="line">    WdfDeviceInitSetPnpPowerEventCallbacks(DeviceInit, &amp;pnpPowerCallbacks);</span><br><span class="line">    ....</span><br><span class="line">    <span class="comment">// WdfDeviceCreate();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">Bus_EvtDevicePrepareHardware</span><span class="params">(IN WDFDEVICE Device, IN WDFCMRESLIST ResourcesRaw, IN WDFCMRESLIST ResourcesTranslated)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// use WdfCmResourceListGetCount(ResourcesRaw) to get the number of resources.</span></span><br><span class="line">    <span class="comment">// use WdfCmResourceListGetDescriptor(ResourcesRaw, i) to get the i-th PCM_PARTIAL_RESOURCE_DESCRIPTOR.</span></span><br><span class="line">    <span class="comment">// use descriptor-&gt;Type to determine the resource type (CmResourceTypePort or CmResourceTypeInterrupt or something else).</span></span><br><span class="line">    <span class="comment">// save the gethered resources to the DEVICE_EXTENSION structure</span></span><br><span class="line">    <span class="comment">// that you previously defined.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>When enumerating the subdevices, the bus device’s ResourcesQuery callback and ResourceRequirementsQuery callback will be called.<br>The callback registration should also before the invocation of WdfDeviceCreate of the PDO.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">EVT_WDF_DEVICE_RESOURCES_QUERY Bus_EvtDeviceResourcesQuery;</span><br><span class="line">EVT_WDF_DEVICE_RESOURCE_REQUIREMENTS_QUERY Bus_EvtDeviceResourceRequirementsQuery;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ALLOC_PRAGMA</span></span><br><span class="line"><span class="function">pragma <span class="title">alloc_text</span> <span class="params">(PAGE, Bus_EvtDeviceResourcesQuery)</span></span>;</span><br><span class="line"><span class="function">pragma <span class="title">alloc_text</span> <span class="params">(PAGE, Bus_EvtDeviceResourceRequirementsQuery)</span></span>;</span><br><span class="line"></span><br><span class="line">WDF_PDO_EVENT_CALLBACKS pdoCallbacks;</span><br><span class="line">WDF_PDO_EVENT_CALLBACK_INIT(&amp;pdoCallbacks);</span><br><span class="line"></span><br><span class="line">pdoCallbacks.EvtDeviceResourcesQuery = Bus_EvtDeviceResourcesQuery;</span><br><span class="line">pdoCallbacks.EvtDeviceResourceRequirementsQuery = Bus_EvtDeviceResourceRequirementsQuery;</span><br><span class="line"></span><br><span class="line">WdfPdoInitSetEventCallbacks(pDeviceInit, &amp;pdoCallbacks);</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">Bus_EvtDeviceResourcesQuery</span><span class="params">(IN WDFDEVICE Device, IN WDFIRESLIST Resources)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// assign the subdevice resources</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">Bus_EvtDeviceResourceRequirementsQuery</span><span class="params">(IN WDFDEVICE, IN WDFIORESREQLIST IoResourceRequirementsList)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// assign the subdevice resources</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// note that: the logic of the above two functions are almost the same</span></span><br></pre></td></tr></table></figure>
<h2 id="For-Sub-device-Driver"><a href="#For-Sub-device-Driver" class="headerlink" title="For Sub-device Driver"></a>For Sub-device Driver</h2><p>the subdevice should register the callback funtion prepareHardware like the bus driver, then do the additional step:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">EVT_WDF_DEVICE_REMOVE_ADDED_RESOURCES Bus_EvtDeviceRemoveAddedResources;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">xxxEvtDevicdAdd</span><span class="params">(IN WDFDRIVER Driver, IN PWDFDEVICE_INIT DeviceInit)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    ....</span><br><span class="line"></span><br><span class="line">    WDF_FDO_EVENT_CALLBACKS fdoCallbacks;</span><br><span class="line"></span><br><span class="line">    WDF_FDO_EVENT_CALLBACKS_INIT(&amp;fdoCallbacks);</span><br><span class="line">    fdoCallbacks.EvtDeviceRemoveAddedResources = Bus_EvtDeviceRemoveAddedResources;</span><br><span class="line">    WdfFdoInitSetEventCallbacks(DeviceInit, &amp;fdoCallbacks);</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">NTSTATUS <span class="title">Bus_EvtDeviceRemoveAddedResources</span><span class="params">(IN WDFDEVICE Device, IN WDFCMRESLIST ResourcesRaw, IN WDFCMRESLIST ResourcesTranslated)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// just use WdfCmResourceListRemove(ResourcesRaw, i) and WdfCmResourceListRemove(ResourcesTranslated, i)</span></span><br><span class="line">    <span class="comment">// to remove the subdevice's i-th resource so that the bus device will not use the resources.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="inf-example"><a href="#inf-example" class="headerlink" title="inf example"></a>inf example</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">;</span><br><span class="line">; test.inf</span><br><span class="line">;整个配置文件安装成功后会在注册表生成一个实例子健 具体位置为：HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Enum</span><br><span class="line"></span><br><span class="line">;--------- Version Section ---------------------------------------------------</span><br><span class="line"></span><br><span class="line">[Version]</span><br><span class="line"></span><br><span class="line">;可以是$Chicage$、$Windows NT$(含有一个空格)、$Windows 95$(含有一个空格)之一，定界符$必不可少，且这些串是不分大小写的。</span><br><span class="line">;如果Signature的值不是这些有效的串之一，该INF文件就被认为无效</span><br><span class="line">Signature=&quot;$WINDOWS NT$&quot;  </span><br><span class="line"></span><br><span class="line">;INF文件的提供者</span><br><span class="line">Provider=drsn_Device  </span><br><span class="line">  </span><br><span class="line">;INF文件的版本信息，时间和版本不变的情况下，修改了SYS文件，重新安装INF文件是看不到SYS变化的</span><br><span class="line">;因为系统已经存根了此版本的INF和SYS,它会直接加载已有的文件,调试SYS特别要主要这个问题</span><br><span class="line">;如果使用VS2012编译,它会自动帮你填写这里,比较省心</span><br><span class="line">DriverVer=08/31/2013,8.33.48.258</span><br><span class="line">                  </span><br><span class="line">;如果设备是一个标准类别，使用标准类的名称和GUID 否则创建一个自定义的类别名称，并自定义它的GUID</span><br><span class="line">;自定义的类别在注册表中 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\ 有显示</span><br><span class="line">Class=drsnDevice                  </span><br><span class="line">ClassGuid=&#123;BDC0EAC4-AC4B-46af-82EA-C4958B686515&#125;    </span><br><span class="line">                          </span><br><span class="line"></span><br><span class="line">;--------- SourceDiskNames and SourceDiskFiles Section -----------------------</span><br><span class="line"></span><br><span class="line">;这里两项的设置效果是 加载INF当前目录下的SYS文件</span><br><span class="line">[SourceDisksNames]          </span><br><span class="line">1 = %DiskName%,,,       </span><br><span class="line"></span><br><span class="line">[SourceDisksFiles]</span><br><span class="line">Name_Files_Driver = 1,,       </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;--------- ClassInstall/ClassInstall32 Section -------------------------------</span><br><span class="line"></span><br><span class="line">;如果不是标准类别设备，这里的配置必须的</span><br><span class="line">[ClassInstall32]          </span><br><span class="line">Addreg=Class_AddReg</span><br><span class="line"></span><br><span class="line">;对应的注册表是 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\</span><br><span class="line">[Class_AddReg]  </span><br><span class="line">HKR,,,,%DeviceClassName%      </span><br><span class="line">HKR,,Icon,,&quot;-5&quot; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;--------- DestinationDirs Section -------------------------------------------</span><br><span class="line"></span><br><span class="line">;把文件呢复制到相应的目录下，在win2000及其以后系统，12表示%windir%/system32/drivers </span><br><span class="line">;win98中12表示%windir%/system/IoSubsys 所以为了兼容大家都写成10,System32\Drivers</span><br><span class="line">[DestinationDirs]         </span><br><span class="line">Name_Files_Driver = 12        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;--------- Manufacturer and Models Sections ----------------------------------  </span><br><span class="line"></span><br><span class="line">;这里是设置模型相关的选项，注意这里VS默认生成的标准设备的配置 如：%ManufacturerName%=Standard,NT$ARCH$</span><br><span class="line">;如果不是标准类别设备这里必须修改，要不然最后加载的时候会出现259错误</span><br><span class="line">[Manufacturer]</span><br><span class="line">%ManufacturerName%=Mfg0       </span><br><span class="line">        </span><br><span class="line">;这里是模型节的节名，和硬件ID 这个ID可以自定义          </span><br><span class="line">[Mfg0]</span><br><span class="line">%DeviceDesc%=SysInstall, PCI\VEN_8888&amp;DEV_8888    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;---------- DDInstall Sections -----------------------------------------------</span><br><span class="line"></span><br><span class="line">;这里需要注意WIN2000及其以上的系统这里有个.NT，如果是98这里是[SysInstall]，必须要正确设置</span><br><span class="line">[SysInstall.NT]           </span><br><span class="line">CopyFiles=Name_Files_Driver  </span><br><span class="line">AddReg=Install_NT_AddReg</span><br><span class="line"></span><br><span class="line">;这里的drsnWDM是注册表中的服务名 具体地址是 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services</span><br><span class="line">[SysInstall.NT.Services]  </span><br><span class="line">Addservice = drsnWDM, 0x00000002, Sys_AddService  </span><br><span class="line"></span><br><span class="line">;服务的具体选项</span><br><span class="line">[Sys_AddService]  </span><br><span class="line">DisplayName = %SvcDesc%               </span><br><span class="line">ServiceType = 1 ; SERVICE_KERNEL_DRIVER  </span><br><span class="line">StartType = 3 ; SERVICE_DEMAND_START  </span><br><span class="line">ErrorControl = 1 ; SERVICE_ERROR_NORMAL  </span><br><span class="line"></span><br><span class="line">;这个地方虽然和[Name_Files_Driver]相同但是不能引用，所以只能照实来写</span><br><span class="line">ServiceBinary = %12%\test.sys </span><br><span class="line"></span><br><span class="line">[Install_NT_AddReg]  </span><br><span class="line">HKLM, &quot;System\CurrentControlSet\Services\drsnWDM\Parameters&quot;,\  </span><br><span class="line">&quot;BreakOnEntry&quot;, 0x00010001, 0 </span><br><span class="line"></span><br><span class="line">; --------- Files (common) -------------  </span><br><span class="line"></span><br><span class="line">;sys文件名 便于配置文件其它地方使用</span><br><span class="line">[Name_Files_Driver]                 </span><br><span class="line">test.sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">;--------- Strings Section ---------------------------------------------------  </span><br><span class="line"></span><br><span class="line">;字符串设置 便于配置文件其它地方使用</span><br><span class="line">[Strings]                     </span><br><span class="line">ProviderName=&quot;drsn&quot; </span><br><span class="line">ManufacturerName=&quot;drsn soft&quot;</span><br><span class="line">DiskName=&quot;test Source Disk&quot;</span><br><span class="line">DeviceDesc=&quot;test protect&quot; </span><br><span class="line">SvcDesc=&quot;drsn&quot; </span><br><span class="line">DeviceClassName=&quot;drsn_Device&quot;</span><br></pre></td></tr></table></figure>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/22/Windows-Device-Driver/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/22/Windows-Embedded/">
                            Windows Embedded
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-22T11:23:28+08:00">
	
		    22 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="自定义-Shell"><a href="#自定义-Shell" class="headerlink" title="自定义 Shell"></a>自定义 Shell</h2><p>默认情况下，构建 XPE 时，我们都选择 Explorer Shell，可如果我们想要在进入系统后，默认打开其他的应用程序呢？这里可以使用Component Designer 来建立自定义 Shell 组件，之后在检查依赖性的时候，就可以只选择我们自定义的 Shell 而不选择 Explorer Shell 了。</p>
<h2 id="最小化-XPE"><a href="#最小化-XPE" class="headerlink" title="最小化 XPE"></a>最小化 XPE</h2><p>在最小化 XPE 的过程中，类似 Networking 这样的组件，虽然我们用不到，可是也需要添加到系统中，否则无法通过依赖性检查。</p>
<h2 id="EWF-Enhanced-Write-Filter"><a href="#EWF-Enhanced-Write-Filter" class="headerlink" title="EWF (Enhanced Write Filter)"></a>EWF (Enhanced Write Filter)</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>EWF 是 Windows 提供的一种针对磁盘分区的保护机制，将所有对分区的更改都只保留在内存中，并不向磁盘进行任何的数据写入，在系统重启之后，分区能够保持未更改的状态，我们可以用这种方法来防病毒。</p>
<h3 id="XPE-下-EWF-的安装"><a href="#XPE-下-EWF-的安装" class="headerlink" title="XPE 下 EWF 的安装"></a>XPE 下 EWF 的安装</h3><ol>
<li><p>在 Target Designer 中添加一下四个组件：</p>
<ul>
<li><p>EWF NTLDR</p>
</li>
<li><p>Enhanced Write Filter</p>
</li>
<li><p>Enhanced Write Filter API (EWF API)</p>
</li>
<li><p>EWF Manager Console application</p>
</li>
</ul>
</li>
<li><p>需要删除一个组件：</p>
<ul>
<li>NT Loader</li>
</ul>
</li>
<li><p>在 Enhanced Write Filter 组件的 Settings 中，做如下设定：</p>
<ol>
<li><p>取消 Start EWF Enabled 勾选</p>
</li>
<li><p>在 Partition Number 一项中填写合适的值，默认是 1，表示保护第一个分区（即 C 盘），用户可以根据实际情况进行选择</p>
</li>
<li><p>Overlay Type 一项，选择 RAM</p>
</li>
</ol>
</li>
<li><p>检查组件依赖性并编译系统镜像</p>
</li>
</ol>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>FBA 之后的第一次启动，如果在命令行中用 ewfmgr <n>: 来查看现在的 EWF 保护情况，会出现错误，需要将下面的代码制作成 .reg 注册表文件，双击运行并重启系统，之后再用命令 ewfmgr <n>: 查看 EWF 的保护状态，就会给出正常的结果了，当前的状态应该是 Enable。</n></n></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Windows Registry Editor Version 5.00</span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ewf]</span><br><span class="line">&quot;ErrorControl&quot;=dword:00000001</span><br><span class="line">&quot;Group&quot;=&quot;System Bus Extender&quot;</span><br><span class="line">&quot;Start&quot;=dword:00000000</span><br><span class="line">&quot;Type&quot;=dword:00000001</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\&#123;71A27CDD-812A-11D0-BEC7-08002BE2092F&#125;]</span><br><span class="line">&quot;UpperFilters&quot;=&quot;Ewf&quot;</span><br><span class="line"></span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ewf\Parameters]</span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ewf\Parameters\Protected]</span><br><span class="line">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ewf\Parameters\Protected\Volume0]</span><br><span class="line">&quot;VolumeID&quot;=&quot;&#123;1EA414D1-6760-4625-8CBE-4F9F85A48E15&#125;&quot;</span><br><span class="line">&quot;Type&quot;=dword:00000001</span><br><span class="line">&quot;ArcName&quot;=&quot;multi(0)disk(0)rdisk(0)partition(1)&quot;</span><br></pre></td></tr></table></figure>
<p>注意：<strong>ArcName 最后的 partition(n) 应该和 Enhanced Write Filter 中 Partition Number 的值保持一致。</strong></p>
<p>采用上述系统 Ghost 出来的新系统，需要正常启动两次，才能使用 EWF 功能。</p>
<p>注：Ghost 软件应使用 DOS 下的纯净 Ghost，Laomaotao 下的 Ghost 工具会在镜像里面添加广告文件。</p>
<h4 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 查看状态</span><br><span class="line">ewfmgr &lt;n&gt;:</span><br><span class="line"></span><br><span class="line">2. 启用保护，重启后生效</span><br><span class="line">ewfmgr &lt;n&gt;: -enable</span><br><span class="line"></span><br><span class="line">3. 撤销保护，立即生效</span><br><span class="line">ewfmgr &lt;n&gt;: -commitanddisable -live</span><br></pre></td></tr></table></figure>
<h3 id="HORM-Hibernate-Once-Resume-Many"><a href="#HORM-Hibernate-Once-Resume-Many" class="headerlink" title="HORM (Hibernate Once Resume Many)"></a>HORM (Hibernate Once Resume Many)</h3><p>HORM 是 EWF 当中的一项技术，在系统首次启动后，如果进入休眠状态，之后的关机，无论是正常关机还是异常关机，都会直接从休眠状态中恢复回来，这样可以显著缩短系统启动的时间。</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/22/Windows-Embedded/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/22/System-Performance-Test/">
                            跨平台计算机性能测试套件
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-22T10:52:13+08:00">
	
		    22 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="CPU-性能测试-UPDATE"><a href="#CPU-性能测试-UPDATE" class="headerlink" title="CPU 性能测试 [UPDATE]"></a>CPU 性能测试 [UPDATE]</h2><p>Stress + htop</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>Phoronix Test Suite 是一款跨平台（Linux/Mac/Windows）的计算机性能测试软件，测试种类共分为五大类：</p>
<ul>
<li><p>System</p>
</li>
<li><p>Memory</p>
</li>
<li><p>Processor</p>
</li>
<li><p>Graphics</p>
</li>
<li><p>Disk</p>
</li>
</ul>
<p>以上每一个分类里面都有若干个工具，我们是用某个分类里的某个工具来对相关性能进行测试的，下面列出每个分类里面的工具：</p>
<h3 id="System"><a href="#System" class="headerlink" title="System"></a>System</h3><p>hint, idle, juliagpu, mandelbulbgpu, mandelgpu, nexuiz-iqc, pgbench, pybench, smallpt-gpu, sunflow, xplane9-iqc</p>
<h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><p>Stream</p>
<h3 id="Processor"><a href="#Processor" class="headerlink" title="Processor"></a>Processor</h3><p>blake2, bork, botan, build-apache, build-php, bullet, byte, c-ray, clomp, compress-7zip, compress-gzip, dcraw, ffmpeg, fhourstones, graphics-magick, himeno, java-scimark2, jgfxbat, john-the-ripper, mafft, mencoder, minion, mrbayes, openssl, polybench-c, primesieve, sample-program, scimark2, stockfish, sudokut, tachyon, tscp</p>
<h3 id="Graphics"><a href="#Graphics" class="headerlink" title="Graphics"></a>Graphics</h3><p>apitest, corebench, j2dbench, nexuiz, openarena, qvdpautest, unvanquished, urbanterror, xonotic, xplane9</p>
<h3 id="Disk"><a href="#Disk" class="headerlink" title="Disk"></a>Disk</h3><p>blogbench, compilebench, postmark, tiobench, unpack-linux</p>
<p>注：这个列表不是很全，没有列出的就是不能用的。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>将下载好的安装包，现在直接从 phoronix-test-suite-packages 里面提取即可，放到 /path/to/phoronix-dir/download-cache 目录下，然后运行下面的命令进行安装，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ phoronix-test-suite install pts/&lt;tool-name&gt;</span><br></pre></td></tr></table></figure>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ phoronix-test-suite run &lt;tool-name&gt;</span><br></pre></td></tr></table></figure>
<h2 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h2><p>如果手头没有下载好的 package 安装包，执行安装命令就会直接从网络上面下载工具并安装，之后，如果我们想要把下载好的包提取出来做个备份，只需要执行下面的命令即可，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ phoronix-test-suite make-download-cache</span><br></pre></td></tr></table></figure>
<p>命令成功执行后，我们就可以从 /path/to/phoronix-dir/download-cache 目录中找到了。</p>
<p>以上就是基本的介绍和使用指南，hope you enjoy it～</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/22/System-Performance-Test/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/22/Programming/">
                            Programming
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-22T10:47:47+08:00">
	
		    22 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="读取文件内容，每次处理一行"><a href="#读取文件内容，每次处理一行" class="headerlink" title="读取文件内容，每次处理一行"></a>读取文件内容，每次处理一行</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> &lt;line&gt;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    <span class="built_in">echo</span> $&lt;line&gt; <span class="comment"># or something else you want to do</span></span><br><span class="line"><span class="keyword">done</span> &lt; &lt;filename&gt;</span><br></pre></td></tr></table></figure>
<h2 id="同时打开两个新终端并执行程序"><a href="#同时打开两个新终端并执行程序" class="headerlink" title="同时打开两个新终端并执行程序"></a>同时打开两个新终端并执行程序</h2><p>源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * test.c</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">func1</span><span class="params">(<span class="keyword">void</span>* args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    system(<span class="string">"gnome-terminal -e ./test1"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">func2</span><span class="params">(<span class="keyword">void</span>* args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    system(<span class="string">"gnome-terminal -e ./test2"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pthread_t</span> thread1, thread2;</span><br><span class="line">    pthread_create(&amp;thread1, <span class="literal">NULL</span>, func1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_create(&amp;thread1, <span class="literal">NULL</span>, func1, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    pthread_join(thread1, <span class="literal">NULL</span>);</span><br><span class="line">    pthread_join(thread2, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>生成可执行程序</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc test.c -o <span class="built_in">test</span> -lpthread</span><br></pre></td></tr></table></figure>
<h2 id="为新线程传递参数"><a href="#为新线程传递参数" class="headerlink" title="为新线程传递参数"></a>为新线程传递参数</h2><p>源代码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">thread_args</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> arg1;</span><br><span class="line">    <span class="keyword">int</span> arg2;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 无论是否传递参数，线程所执行的函数都应该具有如下声明 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">func</span><span class="params">(<span class="keyword">void</span>* args)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">thread_args</span>* <span class="title">myargs</span> = (<span class="title">struct</span> <span class="title">thread_args</span>*) <span class="title">args</span>;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"arg1 is %d, arg2 is %d\n"</span>, myargs-&gt;arg1, myargs-&gt;arg2);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">pthread_t</span> mythread;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">thread_args</span> <span class="title">myargs</span>;</span></span><br><span class="line">    </span><br><span class="line">    myargs.arg1 = <span class="number">100</span>;</span><br><span class="line">    myargs.arg2 = <span class="number">200</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 必须以结构体的形式，将参数传递给新线程 */</span></span><br><span class="line">    pthread_create(&amp;mythread, <span class="literal">NULL</span>, func, &amp;myargs);</span><br><span class="line">    </span><br><span class="line">    pthread_join(mythread, <span class="literal">NULL</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="warning-address-of-stack-memory…"><a href="#warning-address-of-stack-memory…" class="headerlink" title="warning: address of stack memory…"></a>warning: address of stack memory…</h2><p>如果我写了一个返回指针的函数，而在函数体的 return 后面返回的是变量的地址，编译器就会给出警告，说这样是不安全的，所以我们再增加一个指针变量，将那个变量的地址赋给指针变量，最后再返回就好了。</p>
<p>即：应返回指针，而不是变量地址。</p>
<h2 id="Simple-Intro-to-GDB"><a href="#Simple-Intro-to-GDB" class="headerlink" title="Simple Intro to GDB"></a>Simple Intro to GDB</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this is a really simple program called fact.c </span></span><br><span class="line"><span class="comment">// to calculate the factorial of 4</span></span><br><span class="line"><span class="comment">// the expecting result is 24</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i, j;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (j=<span class="number">1</span>; j&lt;<span class="number">5</span>; j++) &#123;</span><br><span class="line">        i = i * j;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"the result is %d\n"</span>, i);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># we use gcc to compile it</span></span><br><span class="line">$ gcc -o fact fact.c</span><br><span class="line"><span class="comment"># then run it</span></span><br><span class="line">$ ./fact</span><br><span class="line">the result is 0</span><br><span class="line"><span class="comment"># that is not what we expeted!</span></span><br></pre></td></tr></table></figure>
<p>So we use gdb to check what is going on~~~</p>
<p>To use gdb, we should add -ggdb to the gcc command line to include information for debugging.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -ggdb -o fact fact.c</span><br></pre></td></tr></table></figure>
<p>Then, We just run the following command to start gdb.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gdb ./fact</span><br></pre></td></tr></table></figure>
<p>and you will get a prompt like this,</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb)</span><br></pre></td></tr></table></figure>
<p>Next, type <strong>r</strong> or <strong>run</strong> and hit enter, you will get the entire program running just like what running the fact executable.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) r</span><br></pre></td></tr></table></figure>
<p>What if we want to stop the program somewhere, just type <strong>b fact.c:5</strong> or <strong>break fact.c:5</strong> to stop the program at line 5 in the source code, or type <strong>b fact.c:main</strong> to stop the program from the very beginning.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) b fact.c: main</span><br></pre></td></tr></table></figure>
<p>If you want to see the source code to determine which line you should break, just type <strong>l</strong> to show a piece of the source code, then another <strong>l</strong>, you will get another piece, also <strong>l 12</strong> will get you to the line 12.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) l 12</span><br></pre></td></tr></table></figure>
<p>Suppose now you are at the <strong>for</strong> loop line, and you want to check the value of i, you can simply type <strong>p i</strong> or <strong>print i</strong> to print the current value of the variable i, further more, if you want to show all the variables, just type <strong>info locals</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info locals</span><br></pre></td></tr></table></figure>
<p>If you want to change the value of some variable, say change the value of i from nothing to 1, you can type <strong>p i = 1</strong>, then hit enter, then <strong>c</strong> or <strong>continue</strong> to continue the rest of the program or <strong>n</strong> to run just the next line of code, if we want to execute the program line by line, you can save you typing by just hit enter, the enter will execute the previous command which is <strong>n</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p i = 1</span><br></pre></td></tr></table></figure>
<p>If you want to quit the gdb, just type <strong>q</strong> or <strong>quit</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(gdb) q</span><br></pre></td></tr></table></figure>
<h2 id="C-redifinition-error"><a href="#C-redifinition-error" class="headerlink" title="C redifinition error"></a>C redifinition error</h2><p>如果工程中有多个头文件，并且有的会互相包含，那么有可能会在编译的时候报出重复定义的错误，因为有的头文件被包含了不止一次，可以通过如下方式解决这个问题：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __SOMEFILE\_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __SOMEFILE\_H__</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * things in the file</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>头文件只会在变量未定义的情况下被包含一次，这样就很好的避免了重复定义的错误。</p>
<h2 id="如何编写并使用-DLL"><a href="#如何编写并使用-DLL" class="headerlink" title="如何编写并使用 DLL"></a>如何编写并使用 DLL</h2><h3 id="生成-DLL"><a href="#生成-DLL" class="headerlink" title="生成 DLL"></a>生成 DLL</h3><p>首先在 VC++ 6.0 中新建 Win32 Dynamic-Link Library 工程 testDLL，然后新建如下两个文件，EXPORT.h 和 testDLL.cpp。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * EXPORT.h</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> EXPORTING_DLL</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> __declspec (dllexport) <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> __declspec (dllimport) <span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * testDLL.cpp</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXPORTING_DLL</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"EXPORT.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后，会生成两个文件 testDLL.dll 和 testDLL.lib。</p>
<h3 id="使用-DLL"><a href="#使用-DLL" class="headerlink" title="使用 DLL"></a>使用 DLL</h3><ol>
<li><p>新建一个 Win32 Console Application 工程 test，将 testDLL.lib 添加到<br>Project->Settings->Link 选项卡下的 Object/library modules 中。</p>
</li>
<li><p>将刚才生成的 testDLL.dll，testDLL.lib 以及 EXPORT.h 复制到 test 的工程目录中。</p>
</li>
<li><p>在 test 工程中新建文件 test.c 并添加如下内容</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * test.c</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"><span class="comment">#include "EXPORT.h"</span></span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"the result of 1+2 is %d\n"</span>, add(1, 2));</span><br><span class="line">    <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用-vs2013-需要注意的地方"><a href="#使用-vs2013-需要注意的地方" class="headerlink" title="使用 vs2013 需要注意的地方"></a>使用 vs2013 需要注意的地方</h3><h4 id="让-vs2013-生成兼容-XP-的应用程序"><a href="#让-vs2013-生成兼容-XP-的应用程序" class="headerlink" title="让 vs2013 生成兼容 XP 的应用程序"></a>让 vs2013 生成兼容 XP 的应用程序</h4><p>默认是不兼容 XP 的。</p>
<p>右键单击工程-&gt;Properties-&gt;General-&gt;General-&gt;Platform Toolset: Visual Studio 2013 - Windows XP (v120_xp)</p>
<h4 id="字符集设置"><a href="#字符集设置" class="headerlink" title="字符集设置"></a>字符集设置</h4><p>默认情况下，使用双引号字符串会报错，采用下面的方法避免这个错误的产生。</p>
<p>右键单击工程-&gt;Properties-&gt;General-&gt;Project Defaults-&gt;Character Set: Not Set/Use Multi-Byte Character Set</p>
<h4 id="动态库使用问题"><a href="#动态库使用问题" class="headerlink" title="动态库使用问题"></a>动态库使用问题</h4><p>右键单击工程-&gt;Properties-&gt;Linker-&gt;Input-&gt;Additional Dependencies，然后添加自己的 DLL。</p>
<h4 id="修改-MFC-默认工程的图标"><a href="#修改-MFC-默认工程的图标" class="headerlink" title="修改 MFC 默认工程的图标"></a>修改 MFC 默认工程的图标</h4><p>ico 文件一般可以通过 png 文件转换得到。<br>直接将做好的 ico 文件替换到工程中的 res 目录，然后重新编译即可。</p>
<h4 id="DeviceIoControl"><a href="#DeviceIoControl" class="headerlink" title="DeviceIoControl"></a>DeviceIoControl</h4><p>如果想要使用 IOCTL 的特定控制字，需要调用 DeviceIoControl 函数，该函数需要头文件 windows.h。</p>
<h2 id="astyle-Code-Formatting-Tool"><a href="#astyle-Code-Formatting-Tool" class="headerlink" title="astyle Code Formatting Tool"></a>astyle Code Formatting Tool</h2><p>astyle 是一个开源的代码格式化工具，现在将常用选项列在下面：</p>
<table>
<thead>
<tr>
<th>选项</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>–style=kr / -A3</td>
<td>采用 K&amp;R 代码格式</td>
</tr>
<tr>
<td>–preserve-date / -Z</td>
<td>不改变文件修改时间</td>
</tr>
<tr>
<td>–unpad-paren / -U</td>
<td>将括号内侧空格去掉</td>
</tr>
<tr>
<td>–pad-header / -H</td>
<td>在 if/else 等后面添加空格</td>
</tr>
<tr>
<td>–align-pointer=type / -k1</td>
<td>将指针前的星号和指针类型连在一起</td>
</tr>
<tr>
<td>–align-reference=name / -W3</td>
<td>将&amp;符号同所引用的变量连在一起 ｜</td>
</tr>
<tr>
<td>–convert-tabs / -c</td>
<td>将 tab 转换为 space</td>
</tr>
<tr>
<td>–indent=spaces=4 / -s4</td>
<td>采用空格进行缩紧，一个单位为 4 个空格</td>
</tr>
<tr>
<td>–break-blocks / -f</td>
<td>在不相关的代码块间插入空格</td>
</tr>
<tr>
<td>–add-brackets / -j</td>
<td>在单行条件代码外添加大括号</td>
</tr>
<tr>
<td>–errors-to-stdout / -X</td>
<td>将错误输出到标准输出上</td>
</tr>
</tbody>
</table>
<h2 id="referencing-an-external-css-file"><a href="#referencing-an-external-css-file" class="headerlink" title="referencing an external css file"></a>referencing an external css file</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"stylesheet.css"</span>\&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="module-object-has-no-attribute-‘OrderedDict’"><a href="#module-object-has-no-attribute-‘OrderedDict’" class="headerlink" title="module object has no attribute ‘OrderedDict’"></a>module object has no attribute ‘OrderedDict’</h2><p>OrderedDict 在 Python2.7 才开始加入了该支持，所以如果 Python 的当前版本低于 2.7，就会报这个错误。</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/22/Programming/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/22/Things-Need-to-Know-about-Linux/">
                            Linux
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-22T10:05:04+08:00">
	
		    22 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="Ubuntu-登录及注销时自动执行的脚本策略"><a href="#Ubuntu-登录及注销时自动执行的脚本策略" class="headerlink" title="Ubuntu 登录及注销时自动执行的脚本策略"></a>Ubuntu 登录及注销时自动执行的脚本策略</h2><h3 id="登录时"><a href="#登录时" class="headerlink" title="登录时"></a>登录时</h3><ol>
<li><p>~/.bash_profile</p>
</li>
<li><p>~/.bash_login</p>
</li>
<li><p>~/.profile</p>
</li>
</ol>
<p>按顺序查找，只执行最先找到的那个脚本。</p>
<h3 id="注销时"><a href="#注销时" class="headerlink" title="注销时"></a>注销时</h3><p>~/.bash_logout</p>
<h2 id="Hash-sum-mismatch-error-while-updating-Ubuntu"><a href="#Hash-sum-mismatch-error-while-updating-Ubuntu" class="headerlink" title="Hash sum mismatch error while updating Ubuntu"></a>Hash sum mismatch error while updating Ubuntu</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo rm -rf /var/lib/apt/lists/*</span><br><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>
<h2 id="Ubuntu-切换到命令行模式的三种方法"><a href="#Ubuntu-切换到命令行模式的三种方法" class="headerlink" title="Ubuntu 切换到命令行模式的三种方法"></a>Ubuntu 切换到命令行模式的三种方法</h2><ol>
<li><p>sudo init 1;</p>
</li>
<li><p>切换到其他终端：crtl + alt + Fn</p>
</li>
<li><p>sudo /etc/init.d/gdm stop</p>
</li>
</ol>
<h2 id="Authentication-failure"><a href="#Authentication-failure" class="headerlink" title="Authentication failure"></a>Authentication failure</h2><p>Ubuntu 默认不开启 root 帐户，如果使用了 su 命令的话，会提示 authentication failure。</p>
<p>这时，需要用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo passwd root</span><br></pre></td></tr></table></figure>
<p>为 root 帐户设置密码。</p>
<h2 id="系统自动发送串口测试指令-AT-GCAP"><a href="#系统自动发送串口测试指令-AT-GCAP" class="headerlink" title="系统自动发送串口测试指令 (AT+GCAP)"></a>系统自动发送串口测试指令 (AT+GCAP)</h2><p>在正常加载驱动后，Ubuntu 的 ModemManager 会自动对串口进行测试，那么就会发现，还没有启动串口就已经有数据从串口发送出去了，要避免这种情况的发生，需要做下面的步骤，将 ModemManager 功能禁用掉。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/dbus-1/system-services</span><br><span class="line">mv org.freedesktop.ModemManager.service org.freedesktop.ModemManager.service.disabled</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>
<h2 id="Remove-unused-kernel-images"><a href="#Remove-unused-kernel-images" class="headerlink" title="Remove unused kernel images"></a>Remove unused kernel images</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname -r</span><br><span class="line">dpkg --list | grep linux-image</span><br><span class="line">sudo apt-get purge linux-image-x.x.x.x-generic</span><br></pre></td></tr></table></figure>
<h2 id="unknown-filesystem-grub-rescue"><a href="#unknown-filesystem-grub-rescue" class="headerlink" title="unknown filesystem: grub rescue"></a>unknown filesystem: grub rescue</h2><ol>
<li><p>ls 列出所有硬盘分区</p>
</li>
<li><p>ls (hd0,x)/ 检查分区中是否存在安装的系统</p>
</li>
<li><p>如果找到分区，则:</p>
</li>
<li><p>set root=(hd0,x)</p>
</li>
<li><p>set prefix=(hd0,x)/boot/grub</p>
</li>
<li><p>insmod /boot/grub/i386-pc/normal.mod</p>
</li>
<li><p>normal</p>
</li>
</ol>
<p>正常情况下应该进入到启动列表，然后按 c 进入 grub 命令行：</p>
<ol>
<li><p>set root=(hd0,x)</p>
</li>
<li><p>linux /boot/vmlinuz-xxx root=/dev/sda(y)</p>
</li>
<li><p>initrd /boot/initrd-xxx</p>
</li>
<li><p>boot</p>
</li>
</ol>
<p>如果成功的话就能够正常进入 ubuntu系统了，进入系统后，打开 terminal：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo grub-install /dev/sda</span><br><span class="line">sudo depmod</span><br><span class="line">sudo update-grub</span><br><span class="line">sudo reboot</span><br></pre></td></tr></table></figure>
<h2 id="vim-方向键变字母的问题"><a href="#vim-方向键变字母的问题" class="headerlink" title="vim 方向键变字母的问题"></a>vim 方向键变字母的问题</h2><ul>
<li><p>方法一</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove vim-common; sudo apt-get install vim</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit ~/.vimrc</span><br><span class="line">添加</span><br><span class="line"><span class="built_in">set</span> nocompatible</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Install-Boot-Repair-on-Ubuntu"><a href="#Install-Boot-Repair-on-Ubuntu" class="headerlink" title="Install Boot-Repair on Ubuntu"></a>Install Boot-Repair on Ubuntu</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:yannubuntu/boot-repair</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install boot-repair</span><br></pre></td></tr></table></figure>
<h2 id="configure-error-C-preprocessor-“-lib-cpp”-fails-sanity-check"><a href="#configure-error-C-preprocessor-“-lib-cpp”-fails-sanity-check" class="headerlink" title="configure: error: C++ preprocessor “|lib|cpp” fails sanity check"></a>configure: error: C++ preprocessor “|lib|cpp” fails sanity check</h2><p>在编译软件时，如果出现上面错误，在 centos 下运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>
<p>即可。</p>
<h2 id="grep-lines-containing-tab-character"><a href="#grep-lines-containing-tab-character" class="headerlink" title="grep lines containing tab character"></a>grep lines containing tab character</h2><p>Using a regular form to grep lines in file.txt containing tab character, be careful about the $ sign before the ‘\t’ expression.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep $<span class="string">'\t'</span> file.txt</span><br></pre></td></tr></table></figure>
<p>Using perl script to grep lines in file.txt containing tab character, -P (uppercase) option means perl.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -P <span class="string">'\t'</span> file.txt</span><br></pre></td></tr></table></figure>
<p>Grep lines in file.txt not containing tab character, -v option means reverse.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -v $<span class="string">'\t'</span> file.txt</span><br></pre></td></tr></table></figure>
<h2 id="grep-find-指定文件范围查找"><a href="#grep-find-指定文件范围查找" class="headerlink" title="grep+find 指定文件范围查找"></a>grep+find 指定文件范围查找</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -i name <span class="string">"*.c"</span> -<span class="built_in">exec</span> grep <span class="string">"hello"</span> &#123;&#125; \;</span><br></pre></td></tr></table></figure>
<h2 id="Kernel-Panic-not-syncing-VFS-Unable-to-mount-root-fs-on-unknown-block-0-0"><a href="#Kernel-Panic-not-syncing-VFS-Unable-to-mount-root-fs-on-unknown-block-0-0" class="headerlink" title="Kernel Panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)"></a>Kernel Panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo initramfs -u -k version</span><br><span class="line">sudo update-grub2</span><br></pre></td></tr></table></figure>
<h2 id="安装-Nvidia-显卡驱动"><a href="#安装-Nvidia-显卡驱动" class="headerlink" title="安装 Nvidia 显卡驱动"></a>安装 Nvidia 显卡驱动</h2><ol>
<li><p>禁用 SELinux</p>
</li>
<li><p>将 “blacklist nouveau” 添加到 /etc/modprob.d/blacklist.conf 文件末尾</p>
</li>
<li><p>将 /etc/grub.conf 中的 “nouveau.modeset=0” 去掉</p>
</li>
<li><p>执行 init 3</p>
</li>
<li><p>执行 xxx.run 驱动安装脚本</p>
</li>
<li><p>备份 /etc/X11/xorg.conf 后，将该文件删掉</p>
</li>
<li><p>重新启动系统。</p>
</li>
</ol>
<h2 id="ssh-keygen-的使用方法"><a href="#ssh-keygen-的使用方法" class="headerlink" title="ssh-keygen 的使用方法"></a>ssh-keygen 的使用方法</h2><p>为了让两个 Linux 机器之间使用 ssh 不需要用户名和密码，采用数字签名 RSA 或者 DSA 来完成这个操作。</p>
<h3 id="模型分析"><a href="#模型分析" class="headerlink" title="模型分析"></a>模型分析</h3><p>假设 A (192.168.20.59) 为客户机器，B (192.168.20.60) 为目标机。</p>
<p>要达到的目的：</p>
<p>A 机器 ssh 登录 B 机器无需输入密码；</p>
<p>加密方式选 rsa 或者 dsa 均可以，默认是 dsa。</p>
<h3 id="具体操作流程"><a href="#具体操作流程" class="headerlink" title="具体操作流程"></a>具体操作流程</h3><h4 id="单向登陆的操作过程（能满足上边的目的）"><a href="#单向登陆的操作过程（能满足上边的目的）" class="headerlink" title="单向登陆的操作过程（能满足上边的目的）"></a>单向登陆的操作过程（能满足上边的目的）</h4><ol>
<li><p>登录 A 机器</p>
</li>
<li><p>ssh-keygen -t [rsa|dsa]，将会生成密钥文件和私钥文件 id_rsa, id_rsa.pub 或 id_dsa, id_dsa.pub</p>
</li>
<li><p>将 .pub 文件复制到 B 机器的 .ssh 目录， 并 cat id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</p>
</li>
<li><p>大功告成，从 A 机器登录 B 机器的目标账户，不再需要密码了。（直接运行 ssh 192.168.20.60）</p>
</li>
</ol>
<h4 id="双向登陆的操作过程"><a href="#双向登陆的操作过程" class="headerlink" title="双向登陆的操作过程"></a>双向登陆的操作过程</h4><p>ssh-keygen 做密码验证可以使在向对方机器上 ssh, scp 不用使用密码。具体方法如下:</p>
<ol>
<li><p>在两个机器上互相执行上面的 1～3 步</p>
</li>
<li><p>设置文件和目录权限：</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod 600 authorized_keys</span><br><span class="line">chmod 700 -R .ssh</span><br></pre></td></tr></table></figure>
<p> 要保证 .ssh 和 authorized_keys 都<strong>只有用户自己有写权限，否则验证无效</strong>。</p>
</li>
</ol>
<h2 id="Ubuntu-10-04-如何进入-grub-命令行"><a href="#Ubuntu-10-04-如何进入-grub-命令行" class="headerlink" title="Ubuntu 10.04 如何进入 grub 命令行"></a>Ubuntu 10.04 如何进入 grub 命令行</h2><p>Ubuntu 从 10.04 开始使用 GRUB2.0 版本，默认安装情况下 grub2 启动菜单是隐藏的，除非您改动了 /etc/default/grub 中的设置。</p>
<p>打开 grub2 启动菜单的方法：</p>
<p>在开机启动时一直按 Shift 键，直到 grub2 启动菜单出现，这时候可以按上下方向键选择一个项目，或者直接按 ‘c’ 进入命令行模式。</p>
<h2 id="命令行下查找和替换文本的方法"><a href="#命令行下查找和替换文本的方法" class="headerlink" title="命令行下查找和替换文本的方法"></a>命令行下查找和替换文本的方法</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">'s/&lt;old-string&gt;/&lt;new-string&gt;/g'</span> `grep &lt;old-string&gt; -rl .`</span><br></pre></td></tr></table></figure>
<h2 id="Getting-part-of-a-string"><a href="#Getting-part-of-a-string" class="headerlink" title="Getting part of a string"></a>Getting part of a string</h2><p>Getting the “File” part</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"File.txt"</span> | cut -d\. -f1</span><br></pre></td></tr></table></figure>
<p>Getting the “txt” part</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"File.txt"</span> | cut -d\. -f2</span><br></pre></td></tr></table></figure>
<p><strong>-fn</strong> stands for the nth field</p>
<p><strong>-d.</strong> means we use dot character as delimiter. <strong>cut</strong> command uses tab as its delimiter by default.</p>
<p><strong>-s</strong> option means only shows the results contains the delimiter</p>
<h2 id="安装-Grub"><a href="#安装-Grub" class="headerlink" title="安装 Grub"></a>安装 Grub</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mount /dev/sdaX /mnt</span><br><span class="line">grub-install --root-directory=/mnt /dev/sdX</span><br></pre></td></tr></table></figure>
<h2 id="gawk"><a href="#gawk" class="headerlink" title="gawk"></a>gawk</h2><p><strong>需要系统中有 troff</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">make</span><br><span class="line"><span class="built_in">cd</span> doc/</span><br><span class="line">make awkward.pdf</span><br></pre></td></tr></table></figure>
<h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><h3 id="下载-https-链接"><a href="#下载-https-链接" class="headerlink" title="下载 https 链接"></a>下载 https 链接</h3><p>需要添加 –no-check-certificate 选项</p>
<h3 id="在配置文件中添加代理"><a href="#在配置文件中添加代理" class="headerlink" title="在配置文件中添加代理"></a>在配置文件中添加代理</h3><p>编辑 ~/.wgetrc 文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http_proxy=http://127.0.0.1:8088</span><br><span class="line">https_proxy=http://127.0.0.1:8088</span><br><span class="line">ftp_proxy=http://127.0.0.1:8088</span><br><span class="line">use_proxy=off (默认不开启代理)</span><br></pre></td></tr></table></figure>
<p>之后可在命令中用 -Y on 来手动开启代理。</p>
<h2 id="Bochs"><a href="#Bochs" class="headerlink" title="Bochs"></a>Bochs</h2><p>Ubuntu 环境下，默认的配置文件为 /etc/bochs-init/bochsrc.</p>
<p>将配置文件中的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">romimage: file=$BXSHARE/BIOS-bochs-latest, address=0xf0000</span><br></pre></td></tr></table></figure>
<p>改成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">romimage: file=$BXSHARE/BIOS-bochs-latest</span><br></pre></td></tr></table></figure>
<p>即可。</p>
<h2 id="diff-的四种格式解读"><a href="#diff-的四种格式解读" class="headerlink" title="diff 的四种格式解读"></a>diff 的四种格式解读</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 传统格式</span></span><br><span class="line">diff &lt;before&gt; &lt;after&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 上下文格式</span></span><br><span class="line">diff -c &lt;before&gt; &lt;after&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 合并格式</span></span><br><span class="line">diff -u &lt;before&gt; &lt;after&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. git diff</span></span><br><span class="line"><span class="comment"># 这种格式不需要文件位于 git 仓库内</span></span><br><span class="line">git diff &lt;before&gt; &lt;after&gt;</span><br></pre></td></tr></table></figure>
<h2 id="几个常用的-RPM-命令"><a href="#几个常用的-RPM-命令" class="headerlink" title="几个常用的 RPM 命令"></a>几个常用的 RPM 命令</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. 查询特定的 rpm 包是否已经安装</span><br><span class="line">rpm -q xxx.rpm</span><br><span class="line"></span><br><span class="line">2. 列出系统中所有的 rpm 包，并在中间按关键字查找</span><br><span class="line">rpm -qa | grep xxx</span><br><span class="line"></span><br><span class="line">3. 删除制定的 rpm 包</span><br><span class="line">rpm -e xxx.rpm</span><br><span class="line">注：如果有依赖关系的话，默认是不能删除的，这时就要用 yum remove 来进行卸载</span><br></pre></td></tr></table></figure>
<h2 id="基础命令的进度监控"><a href="#基础命令的进度监控" class="headerlink" title="基础命令的进度监控"></a>基础命令的进度监控</h2><p>正常情况下，cp 命令是不会显示进度的，如果你打算拷贝一个 20 GB 的文件，天知道要等多久，心里真没底啊。。。。咋办呢？</p>
<p>下面是方法一：</p>
<p>干脆就不用 cp 命令了，改用下面这个：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rsync -av --progress &lt;from&gt; &lt;to&gt;</span><br></pre></td></tr></table></figure>
<p>但是，别的命令咋办呢，比如 mv？正好在 github 上面有这个项目，<a href="https://github.com/BestPig/cv" target="_blank" rel="noopener">Coreutils Viewer</a>，下载之后 make &amp;&amp; make install 就可以了，下面给出使用方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp &lt;from&gt; &lt;to&gt; &amp; cv -m</span><br></pre></td></tr></table></figure>
<p>注意：上面的命令仅仅用了一个 &amp;，用来让 cp 命令在后台执行，而在前台执行 cv -m 命令，目的就是用来监控 cp 的进度，非常方便。</p>
<h2 id="Ubuntu-内核开发环境搭建"><a href="#Ubuntu-内核开发环境搭建" class="headerlink" title="Ubuntu 内核开发环境搭建"></a>Ubuntu 内核开发环境搭建</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><p>OS：ubuntu-12.04.4-desktop-i386</p>
</li>
<li><p>运行环境：虚拟机。内存分配 1GB，CPU 分配一个核心</p>
</li>
<li><p>安装配置：磁盘分配为系统默认，默认选择 “安装时下载” 和 “安装第三方软件“</p>
</li>
<li><p>系统自带内核：3.11.0-15</p>
</li>
<li><p>需要编译的内核：linux-3.11.tar.gz （从 kernel.org 下载）</p>
</li>
<li><p>需要 apt-get 安装组件 build-essential, libncurses-dev, kernel-package</p>
</li>
</ul>
<h3 id="内核编译及安装步骤"><a href="#内核编译及安装步骤" class="headerlink" title="内核编译及安装步骤"></a>内核编译及安装步骤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Desktop; tar zxf linux-3.11.tar.gz; <span class="built_in">cd</span> linux</span><br><span class="line">make mrproper</span><br><span class="line">make menuconfig</span><br><span class="line"><span class="comment"># 界面出来之后直接选择退出，然后选择保存</span></span><br><span class="line">cp /boot/xxx-config .config</span><br><span class="line">make -j&lt;n&gt; <span class="comment">#单核 n=1，双核 n=2</span></span><br><span class="line"><span class="comment"># 接下来会让你确认一个内核选项，是关于 vesa 的，选择 yes 即可</span></span><br><span class="line"><span class="comment"># 然后就进入了编译过程，这里需要漫长的等待，根据上面的虚拟机配置，预计时间为 30 ~ 60 分钟</span></span><br><span class="line">sudo make modules_install</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h3 id="新内核使用及相关问题"><a href="#新内核使用及相关问题" class="headerlink" title="新内核使用及相关问题"></a>新内核使用及相关问题</h3><p>重启后如果找不到 Grub2 启动菜单，需要在启动时按住 Shift 键，然后在菜单上找到 Previous 选择新内核进入系统后，需要重新安装 VMware Tools，否则无法同主机进行文件共享。编译驱动时，如果提示 popt.h: No such file or directory，需要 apt-get 安装 libpopt-dev。</p>
<h2 id="如何验证当前系统是-32-位还是-64-位"><a href="#如何验证当前系统是-32-位还是-64-位" class="headerlink" title="如何验证当前系统是 32 位还是 64 位"></a>如何验证当前系统是 32 位还是 64 位</h2><p>方法一</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ getconf LONG_BIT</span><br></pre></td></tr></table></figure>
<p>方法二</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ file /bin/ls</span><br></pre></td></tr></table></figure>
<h2 id="How-to-Check-and-Use-Serial-Ports-under-Linux"><a href="#How-to-Check-and-Use-Serial-Ports-under-Linux" class="headerlink" title="How to Check and Use Serial Ports under Linux"></a>How to Check and Use Serial Ports under Linux</h2><h3 id="Check-the-System-Initialization-for-Serial-Ports"><a href="#Check-the-System-Initialization-for-Serial-Ports" class="headerlink" title="Check the System Initialization for Serial Ports"></a>Check the System Initialization for Serial Ports</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | grep tty</span><br></pre></td></tr></table></figure>
<h3 id="Check-What-Serial-Ports-Your-Linux-Has"><a href="#Check-What-Serial-Ports-Your-Linux-Has" class="headerlink" title="Check What Serial Ports Your Linux Has"></a>Check What Serial Ports Your Linux Has</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ setserial -g /dev/ttyS[0123]</span><br></pre></td></tr></table></figure>
<h2 id="串口的简单使用"><a href="#串口的简单使用" class="headerlink" title="串口的简单使用"></a>串口的简单使用</h2><ol>
<li><p>查看串口设备信息</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ dmesg | grep tty</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看串口驱动信息</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/tty/drivers/serial</span><br></pre></td></tr></table></figure>
</li>
<li><p>读写</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># read</span></span><br><span class="line">$ cat /dev/ttyS1</span><br><span class="line"><span class="comment"># write</span></span><br><span class="line">$ <span class="built_in">echo</span> 12345 &gt; /dev/ttyS1</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="添加删除用户"><a href="#添加删除用户" class="headerlink" title="添加删除用户"></a>添加删除用户</h2><ol>
<li><p>注销旧用户</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pkill -u &lt;username&gt;</span><br></pre></td></tr></table></figure>
<p> or</p>
<p> 用 ps 命令找到用户登录的终端，然后关闭对应的进程</p>
</li>
<li><p>删除旧用户</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ userdel &lt;username&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加新用户</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ groupadd &lt;groupname&gt;</span><br><span class="line">$ useradd -g &lt;groupname&gt; -d /home/&lt;username&gt; -s /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将用户加入到新组，并不破坏原来的组</span></span><br><span class="line">$ usermod -a -G &lt;groupname&gt; &lt;username&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="运行软件时提示-GLIBCXX-3-4-15-not-found"><a href="#运行软件时提示-GLIBCXX-3-4-15-not-found" class="headerlink" title="运行软件时提示 GLIBCXX_3.4.15 not found"></a>运行软件时提示 GLIBCXX_3.4.15 not found</h2><p>我打算在 fedora 14 上安装使用 Qt5.4.1，能够正常安装，但是打不开 QtCreator，提示 /usr/lib/libstdc++.so.6: GLIBCXX_3.4.15 not found，在官网上下载了 fedora 15 的 libstdc++-4.6.0-6.fc15.i686.rpm，直接安装的话，会和现有的组件起冲突，可以换另外一种方式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对 rpm 进行解压缩</span></span><br><span class="line">$ rpm2cpio libstdc++-4.6.0-6.fc15.i686.rpm | cpio -div</span><br><span class="line"><span class="comment"># 解压出来是一个 usr 文件夹</span></span><br><span class="line">$ <span class="built_in">cd</span> usr/lib/</span><br><span class="line"><span class="comment"># 可以通过下面的命令查看当前动态库是否包含 GLIBCXX_3.4.15</span></span><br><span class="line">$ strings libstdc++.so.6.16 | grep GLIBCXX_3.4.15</span><br><span class="line"></span><br><span class="line">$ sudo cp libstdc++.so.6.16 /usr/lib/; <span class="built_in">cd</span> /usr/lib</span><br><span class="line"><span class="comment"># 删除旧的链接并重新新建</span></span><br><span class="line">$ sudo rm libstdc++.so.6</span><br><span class="line">$ sudo ln -s libstdc++.so.6 libstdc++.so.6.16</span><br></pre></td></tr></table></figure>
<h2 id="修改用户信息"><a href="#修改用户信息" class="headerlink" title="修改用户信息"></a>修改用户信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ chfn &lt;username&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Apache-允许外部主机访问"><a href="#Apache-允许外部主机访问" class="headerlink" title="Apache 允许外部主机访问"></a>Apache 允许外部主机访问</h2><p>如果安装的是 xampp，在 Apache2.4 以后的版本，需要编辑 /opt/xampp/etc/extra/httpd-xampp.conf，找到 LocationMatch，将里面的 Require local 替换为 Require all granted 即可。</p>
<h2 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ifconfig eth0 192.168.1.120 netmask 255.255.255.0</span><br></pre></td></tr></table></figure>
<h2 id="ELDK-安装"><a href="#ELDK-安装" class="headerlink" title="ELDK 安装"></a>ELDK 安装</h2><p>ELDK 是用于生成 u-boot 的开发套件，目前的最新版本是 5.6</p>
<p>下载针对 PowerPC 的镜像 eldk-5.6-powerpc.iso，文件大小 5GB 左右。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mount -t iso9660 -o loop eldk-5.6-powerpc.iso /mnt</span><br><span class="line">$ <span class="built_in">cd</span> /mnt/eldk-5.6/</span><br><span class="line">$ sudo ./install.sh -s toolchain powerpc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来安装会有问题，提示不能读取 toolchain 的 tarball 文件，那么我们就来手动安装</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> /opt/eldk-5.6/powerpc</span><br><span class="line">$ sudo mkdir rootfs-minimal</span><br><span class="line">$ sudo tar xpf /mnt/eldk-5.6/targets/powerpc/core-image-minimal-generic-powerpc.tar.gz -C rootfs-minimal</span><br><span class="line"></span><br><span class="line">$ sudo mkdir rootfs-minimal-dev</span><br><span class="line">$ sudo tar xpf /mnt/eldk-5.6/targets/powerpc/core-image-minimal-dev-generic-powerpc.tar.gz -C rootfs-minimal-dev</span><br><span class="line"></span><br><span class="line">$ sudo mkdir rootfs-minimal-mtdutils</span><br><span class="line">$ sudo tar xpf /mnt/eldk-5.6/targets/powerpc/core-image-minimal-mtdutils-generic-powerpc.tar.gz -C rootfs-minimal-mtdutils</span><br><span class="line"></span><br><span class="line">$ sudo mkdir rootfs-minimal-xenomai</span><br><span class="line">$ sudo tar xpf /mnt/eldk-5.6/targets/powerpc/core-image-minimal-xenomai-generic-powerpc.tar.gz -C rootfs-minimal-xenomai</span><br></pre></td></tr></table></figure>
<h3 id="设置环境变量"><a href="#设置环境变量" class="headerlink" title="设置环境变量"></a>设置环境变量</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/eldk-5.6/powerpc</span><br><span class="line">$ <span class="built_in">source</span> environment-setup-powerpc-linux</span><br><span class="line">$ <span class="built_in">export</span> ARCH=powerpc</span><br><span class="line">$ <span class="built_in">export</span> CROSS_COMPILE=<span class="variable">$&#123;TARGET_PREFIX&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Ubuntu14-04-安装-Sublime-Text-2"><a href="#Ubuntu14-04-安装-Sublime-Text-2" class="headerlink" title="Ubuntu14.04 安装 Sublime Text 2"></a>Ubuntu14.04 安装 Sublime Text 2</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo add-apt-repository ppa:webupd8team/sublime-text-2</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install sublime-text</span><br></pre></td></tr></table></figure>
<h2 id="Terminal-配色方案"><a href="#Terminal-配色方案" class="headerlink" title="Terminal 配色方案"></a>Terminal 配色方案</h2><p>文本颜色设为 #708284，背景颜色设为 #07242E</p>
<h2 id="Ubuntu-用关键字查询已经安装的软件包"><a href="#Ubuntu-用关键字查询已经安装的软件包" class="headerlink" title="Ubuntu 用关键字查询已经安装的软件包"></a>Ubuntu 用关键字查询已经安装的软件包</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkg --get-selections | grep xxx</span><br></pre></td></tr></table></figure>
<h2 id="update-alternatives-学习笔记［转载］"><a href="#update-alternatives-学习笔记［转载］" class="headerlink" title="update-alternatives 学习笔记［转载］"></a>update-alternatives 学习笔记［转载］</h2><h3 id="作用概述"><a href="#作用概述" class="headerlink" title="作用概述"></a>作用概述</h3><ol>
<li>为多个功能相同但名称不同的软件起一个共用的名称；</li>
<li>可以让同一个软件的多个版本共存。</li>
</ol>
<p>Linux 发展到今天，可用的软件已经非常多了。这样自然会有一些软件的功能大致上相同。例如，同样是编辑器，就有 nvi、vim、emacs、nano，而且我说的这些还只是一部分。大多数情况下，这样的功能相似的软件都是同时安装在系统里的，可以用它们的名称来执行。例如，要执行 vim，只要在终端下输入 vim 并按回车就可以了。不过，有些情况下我们需要用一个相对固定的命令调用这些程序中的一个。例如，当我们写一个脚本程序时，只要写下 editor，而不希望要为“编辑器是哪个”而操心。Debian 提供了一种机制来解决这个问题，而 update-alternatives 就是用来实现这种机制的。</p>
<h3 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h3><ol>
<li><p>–display</p>
<p> 它使我们可以看到一个命令的所有可选命令</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update-alternatives --display editor</span><br></pre></td></tr></table></figure>
<p> 可以看到我的机器上的所有可以用来被 editor 链接的命令。</p>
</li>
<li><p>–config</p>
<p> 这个选项使我们可以选择其中一个命令程序来作为 editor</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update-alternatives --config editor</span><br></pre></td></tr></table></figure>
</li>
<li><p>–auto</p>
<p> update-alternatives 在一般情况下是由 postinst 和 prerm 这样的安装脚本自动调用的，所以一个 alternative 的状态有两种：<strong>自动和手动</strong>。每个 alternative 的 <strong>初始状态都是自动</strong>。如果系统发现管理员手动修改了一个 alternative，它的状态就从自动变成了手动，这样安装脚本就不会更新它了。如果你希望将一个 alternative 变回自动，只要执行代码:</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update-alternatives --auto editor</span><br></pre></td></tr></table></figure>
</li>
<li><p>–install</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update-alternatives --install gen link alt pri [--slave sgen slink salt] ...</span><br></pre></td></tr></table></figure>
<p> gen，link，alt，pri 分别在下面解释。如果需要从 alternative，你可以用 –slave。如果你在向一个已经存在的 alternative 组中添加新的 alternative，该命令会把这个 alternative 加入到这个已经存在的 alternative 组的列表中，并用新的可选命令作为新的命令；否则，将会建立一个新的自动的 alternative 组。</p>
</li>
<li><p>–remove</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ update-alternatives --remove name path</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h4><ol>
<li>general name：这是指一系列功能相似的程序的“公用”名字（包括绝对路径），比如 /usr/bin/editor。</li>
<li>link：这是指一个 alternative 在 /etc/alternative 中的名字，比如 editor，–display，–config 和 –auto 后面跟的都是 link。</li>
<li>alternative：顾名思义，这是指一个可选的程序所在的路径（包括绝对路径），比如 /usr/bin/vim。</li>
<li>优先级：这个比较简单，当然优先级越高的程序越好啦。</li>
<li>主和从alternative：想想看，你将 /usr/bin/editor 链接到了 vim，可是当你执行 man editor 时看到的却是 emacs 的 manpage，你会做何感想呢？这就引出了主和从 alternative 的概念了：当更新主的 alternative 时，从的 alternative 也会被更新。</li>
</ol>
<h2 id="多个-gcc-共存"><a href="#多个-gcc-共存" class="headerlink" title="多个 gcc 共存"></a>多个 gcc 共存</h2><p>因为编译软件的需要，Ubuntu 自带的 gcc4.4.1 版本太高，可能需要 gcc3.x，这里选择的是 gcc3.4.4。</p>
<h3 id="下载并安装-deb-安装包"><a href="#下载并安装-deb-安装包" class="headerlink" title="下载并安装 deb 安装包"></a>下载并安装 deb 安装包</h3><p><strong>选择源码包编译安装可能会出错</strong></p>
<p>下载地址为：<a href="http://archive.ubuntu.com/ubuntu/pool/universe/g/gcc-3.4/" target="_blank" rel="noopener">http://archive.ubuntu.com/ubuntu/pool/universe/g/gcc-3.4/</a></p>
<ol>
<li>gcc-3.4-base_3.4.6-6ubuntu3_i386.deb</li>
<li>gcc-3.4_3.4.6-6ubuntu3_i386.deb</li>
<li>cpp-3.4_3.4.6-6ubuntu3_i386.deb</li>
<li>g++-3.4_3.4.6-6ubuntu3_i386.deb</li>
<li>libstdc++6-dev_3.4.6-6ubuntu3_i386.deb</li>
</ol>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><p>目前系统里存在有两个版本的 gcc，缺省值为 gcc4.4.1，这里我们需要改变系统的缺省值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /usr/bin/gcc* -ll</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rwxrwxrwx  1 root root  21      2009-02-10 17:24 /usr/bin/gcc -&gt; /etc/alternatives/gcc</span><br><span class="line">-rwxr-xr-x 1 root root  85552   2008-05-08 18:04 /usr/bin/gcc-3.4</span><br><span class="line">-rwxr-xr-x 1 root root  193372  2008-10-11 03:41 /usr/bin/gcc-4.2</span><br><span class="line">-rwxr-xr-x 1 root root  16090   2008-05-08 17:58 /usr/bin/gccbug-3.4</span><br><span class="line">-rwxr-xr-x 1 root root  2018    2007-06-05 08:59 /usr/bin/gccmakedep</span><br></pre></td></tr></table></figure>
<h3 id="增加-gcc3-4-和-gcc4-3-可选项"><a href="#增加-gcc3-4-和-gcc4-3-可选项" class="headerlink" title="增加 gcc3.4 和 gcc4.3 可选项"></a>增加 gcc3.4 和 gcc4.3 可选项</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-4.2 40</span><br><span class="line">$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-3.4 30</span><br></pre></td></tr></table></figure>
<h3 id="切换版本到-gcc-3-4"><a href="#切换版本到-gcc-3-4" class="headerlink" title="切换版本到 gcc-3.4"></a>切换版本到 gcc-3.4</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --config gcc</span><br></pre></td></tr></table></figure>
<p>现有 2 个可选项，它们都提供了 gcc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1   /usr/bin/gcc-3.4*</span><br><span class="line">2   /usr/bin/gcc-4.2</span><br></pre></td></tr></table></figure>
<p>要维持缺省值 [*]，按回车键，或者键入选择的编号：1</p>
<p>使用 “/usr/bin/gcc-3.4” 来提供 gcc。</p>
<h2 id="no-glxinfo-command"><a href="#no-glxinfo-command" class="headerlink" title="no glxinfo command"></a>no glxinfo command</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install mesa-utils</span><br></pre></td></tr></table></figure>
<h2 id="inode"><a href="#inode" class="headerlink" title="inode"></a>inode</h2><h3 id="A-Brief-Intro"><a href="#A-Brief-Intro" class="headerlink" title="A Brief Intro"></a>A Brief Intro</h3><p>1 sector = 512B = 0.5KiB</p>
<p>1 block contains a series of sectors, commonly 4KiB (8 sectors).</p>
<p>1 disk consists of a data section and a inode section.</p>
<p>1 inode represents 1 file in the disk, it contains</p>
<ul>
<li>size in Bytes</li>
<li>owner ID</li>
<li>group ID</li>
<li>RWX priviledge</li>
<li>timestamp<ul>
<li>ctime (last inode change time)</li>
<li>mtime (last file content change time)</li>
<li>atime (last file access time)</li>
</ul>
</li>
<li>number of links</li>
<li>data section location</li>
</ul>
<h4 id="Files-in-Linux"><a href="#Files-in-Linux" class="headerlink" title="Files in Linux"></a>Files in Linux</h4><ul>
<li>real file<ul>
<li>data</li>
<li>inode</li>
</ul>
</li>
<li>directory<ul>
<li>file list (use the pair (file_name : inode_num))</li>
<li>inode</li>
</ul>
</li>
</ul>
<p>The maximum number of files (a.k.a the number of inodes) is fixed after the disk formatting.</p>
<h3 id="Useful-Commands"><a href="#Useful-Commands" class="headerlink" title="Useful Commands"></a>Useful Commands</h3><h4 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h4><p>show the inode information of file1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">stat</span> file1</span><br></pre></td></tr></table></figure>
<h4 id="df-i"><a href="#df-i" class="headerlink" title="df -i"></a>df -i</h4><p>examine the inode usage of the system:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ df -i</span><br></pre></td></tr></table></figure>
<h4 id="dumpe2fs"><a href="#dumpe2fs" class="headerlink" title="dumpe2fs"></a>dumpe2fs</h4><p>check the inode size of disk sda in the current system:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dumpe2fs -h /dev/sda1 | gerp <span class="string">"Inode size"</span></span><br></pre></td></tr></table></figure>
<p>The result is usually 128B or 256B.</p>
<h4 id="ls-i"><a href="#ls-i" class="headerlink" title="ls -i"></a>ls -i</h4><p>check the inode number of file1:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls -i file1</span><br></pre></td></tr></table></figure>
<h2 id="vmware-workstation-no-3d-support-on-linux"><a href="#vmware-workstation-no-3d-support-on-linux" class="headerlink" title="vmware workstation no 3d support on linux"></a>vmware workstation no 3d support on linux</h2><p>Open the .vmx file of the virtual machine with a text editor, add the following to the end of the file.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mks.gl.allowBlacklistedDrivers = <span class="string">"TRUE"</span></span><br></pre></td></tr></table></figure>
<h2 id="简单的网络诊断方法"><a href="#简单的网络诊断方法" class="headerlink" title="简单的网络诊断方法"></a>简单的网络诊断方法</h2><h3 id="检测网络端口状态"><a href="#检测网络端口状态" class="headerlink" title="检测网络端口状态"></a>检测网络端口状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo netstat -apn</span><br></pre></td></tr></table></figure>
<h3 id="检测防火墙规则"><a href="#检测防火墙规则" class="headerlink" title="检测防火墙规则"></a>检测防火墙规则</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -L</span><br></pre></td></tr></table></figure>
<h3 id="查看防火墙状态"><a href="#查看防火墙状态" class="headerlink" title="查看防火墙状态"></a>查看防火墙状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ufw verbose</span><br></pre></td></tr></table></figure>
                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/22/Things-Need-to-Know-about-Linux/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2015/11/22/Differences-in-Linux-Kernels-for-Device-Driver-Development/">
                            不同内核版本间的差异
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2015-11-22T09:59:02+08:00">
	
		    22 11月 2015
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/Techniques/">Techniques</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h2 id="ioctl-and-unlocked-ioctl"><a href="#ioctl-and-unlocked-ioctl" class="headerlink" title="ioctl and unlocked_ioctl"></a>ioctl and unlocked_ioctl</h2><p>从 2.6.36 版本的内核开始，file_operations 结构体弃用了原来的 ioctl 成员，改用了新的名为 unlocked_ioctl 成员，该成员指向的函数删除了之前函数的第一个参数 inode，所以为了使设备驱动适应多个不同的内核版本，就需要在代码中对内核版本进行判断，进而采用不同的函数的声明：</p>
<p>这里，我们需要包含头文件 <linux version.h="">。</linux></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 6, 36)</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">xxx_ioctl</span><span class="params">(struct inode *inode, struct file *filp, <span class="keyword">unsigned</span> <span class="keyword">int</span> cmd</span></span></span><br><span class="line"><span class="function"><span class="params">, <span class="keyword">unsigned</span> <span class="keyword">long</span> *arg)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">xxx_ioctl</span><span class="params">(struct file *filp, <span class="keyword">unsigned</span> <span class="keyword">int</span> cmd, <span class="keyword">unsigned</span> <span class="keyword">long</span> *arg)</span></span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<p>注意：在函数定义的时候也需要用上面的判断来写函数头。</p>
<p>同样：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">file_operations</span> <span class="title">xxx_fops</span> = </span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    ......</span><br><span class="line">    <span class="meta">#<span class="meta-keyword">if</span> LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 6, 36)</span></span><br><span class="line">    .ioctl = xxx_ioctl,</span><br><span class="line">    #<span class="keyword">else</span></span><br><span class="line">    .unlocked_ioctl = xxx_ioctl,</span><br><span class="line">    #endif</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="init-MUTEX-LOCKED-and-sema-init"><a href="#init-MUTEX-LOCKED-and-sema-init" class="headerlink" title="init_MUTEX_LOCKED and sema_init"></a>init_MUTEX_LOCKED and sema_init</h2><p>从 2.6.37 版本的内核开始，init_MUTEX_LOCKED 宏遭到了弃用，我们只能使用 sema_init 来对锁进行操作，具体代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">semaphore</span> <span class="title">sem</span>;</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 6, 37)</span></span><br><span class="line">    init_MUTEX_LOCKED(&amp;sem);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    sema_init(&amp;sem, <span class="number">0</span>);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h2 id="smp-lock-h-and-hardirq-h"><a href="#smp-lock-h-and-hardirq-h" class="headerlink" title="smp_lock.h and hardirq.h"></a>smp_lock.h and hardirq.h</h2><p>从 2.6.39 版本的内核开始，内核不再包含 smp_lock.h，取而代之的是 hardirq.h。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">if</span> LINUX_VERSION_CODE &lt; KERNEL_VERSION(2, 6, 39)</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/smp_lock.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/hardirq.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure>
<h2 id="asm-system-h-文件"><a href="#asm-system-h-文件" class="headerlink" title="asm/system.h 文件"></a>asm/system.h 文件</h2><p>从 3.4 版本开始，内核不再提供 asm/system.h 文件。</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2015/11/22/Differences-in-Linux-Kernels-for-Device-Driver-Development/#post-footer" class="postShorten-excerpt_link link">
                                Kommentieren und teilen
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
          <li class="pagination-next">
            <a class="btn btn--default btn--small" href="/categories/Techniques/page/2/">
              <span>ÄLTERE BEITRÄGE</span>
              <i class="fa fa-angle-right text-base icon-ml"></i>
            </a>
          </li>
        
        <li class="pagination-number">Seite 1 von 2</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 Michael Wu. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="Bild des Autors"/>
        
            <h4 id="about-card-name">Michael Wu</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Tianjin, China
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->



    </body>
</html>
